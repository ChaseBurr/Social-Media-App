(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{215:function(e,t,n){},228:function(e,t,n){"use strict";n.r(t);var s,a,r,c,o,i,l,d=n(80),j=n.n(d),u=n(0),b=n(35),m=n(18),O=n(242),p=(n(214),n(215),n(17)),h=n(241),x=n(244),g=n(249),f=n(31),v=n(154),y=n(21),I=n(243),C=n(247),w=n(128),N=n(42),S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(u.useState)(t),s=Object(y.a)(n,2),a=s[0],r=s[1],c=function(e){r(Object(N.a)(Object(N.a)({},a),{},Object(w.a)({},e.target.name,e.target.value)))},o=function(t){t.preventDefault(),e()};return{onChange:c,onSubmit:o,values:a}},k=n(60),P=k(s||(s=Object(f.a)(["\n     {\n          getPosts {\n               id\n               body\n               createdAt\n               username\n               likes {\n                    username\n               }\n               comments {\n                    id\n                    username\n                    createdAt\n                    body\n               }\n          }\n     }\n"]))),$=k(a||(a=Object(f.a)(["\n     mutation($postId: ID!, $body: String!) {\n          createComment(postId: $postId, body: $body) {\n               id\n               comments {\n                    id\n                    username\n                    body\n                    createdAt\n               }\n          }\n     }\n"]))),A=k(r||(r=Object(f.a)(["\n     query($postId: ID!) {\n          getPost(postId: $postId) {\n               id\n               body\n               createdAt\n               username\n               likes {\n                    username\n               }\n               comments {\n                    id\n                    username\n                    createdAt\n                    body\n               }\n          }\n     }\n"]))),L=k(c||(c=Object(f.a)(["\n     mutation likePost($postId: ID!) {\n          likePost(postId: $postId) {\n               id\n               likes {\n                    id\n                    username\n               }\n          }\n     }\n"]))),T=k(o||(o=Object(f.a)(["\n     query($username: String!) {\n          getUserInfo(username: $username) {\n               createdAt\n               username\n               description\n          }\n     }\n"]))),M=(k(i||(i=Object(f.a)(["\n     query($username: String!, $body: String!) {\n          userDescription(username: $username, body: $body) {\n               id\n               createAt\n               username\n               description\n          }\n     }\n"]))),n(3));function D(){var e=S((function(){c()}),{body:""}),t=e.values,n=e.onChange,s=e.onSubmit,a=Object(p.useMutation)(E,{variables:t,update:function(e,n){var s=e.readQuery({query:P});e.writeQuery({query:P,data:{getPosts:[n.data.createPost].concat(Object(v.a)(s.getPosts))}}),t.body=""},errorPolicy:"all"}),r=Object(y.a)(a,2),c=r[0],o=r[1].error;return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsxs)(I.a,{onSubmit:s,className:"post-form",children:[Object(M.jsx)("h2",{children:"Create a post"}),Object(M.jsxs)(I.a.Field,{className:"form-section",children:[Object(M.jsx)(I.a.Input,{className:"form-input",placeholder:"Create a post",name:"body",onChange:n,value:t.body,error:!!o}),Object(M.jsx)(C.a,{type:"submit",color:"teal",children:"SUBMIT"})]})]}),o&&Object(M.jsx)("div",{className:"ui error message",style:{marginBottom:"20px"},children:Object(M.jsx)("li",{children:o.graphQLErrors[0].message})})]})}var E=n(60)(l||(l=Object(f.a)(["\n     mutation createPost($body: String!) {\n          createPost(body: $body) {\n               id\n               body\n               createdAt\n               username\n               likes {\n                    id\n                    username\n                    createdAt\n               }\n               # likeCount\n               comments {\n                    id\n                    body\n                    username\n                    createdAt\n               }\n               # commentCount\n          }\n     }\n"]))),U=n(110),Q=n(156),R=n(83),q=n.n(R),G=n(199),F={user:null};if(localStorage.getItem("jwtToken")){var B=Object(G.a)(localStorage.getItem("jwtToken"));1e3*B.exp<Date.now()?localStorage.removeItem("jwtToken"):F.user=B}var z=Object(u.createContext)({user:null,login:function(e){},logout:function(){}});function H(e,t){switch(t.type){case"LOGIN":return Object(N.a)(Object(N.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(N.a)(Object(N.a)({},e),{},{user:null});default:return e}}function J(e){var t=Object(u.useReducer)(H,F),n=Object(y.a)(t,2),s=n[0],a=n[1];return Object(M.jsx)(z.Provider,Object(N.a)({value:{user:s.user,login:function(e){localStorage.setItem("jwtToken",e.token),a({type:"LOGIN",payload:e})},logout:function(){localStorage.removeItem("jwtToken"),a({type:"LOGOUT"})}}},e))}function V(e){var t=e.user,n=e.post,s=n.id,a=n.likes,r=Object(p.useMutation)(L,{variables:{postId:s}}),c=Object(y.a)(r,1)[0],o=Object(u.useState)(!1),i=Object(y.a)(o,2),l=i[0],d=i[1];Object(u.useEffect)((function(){t&&a.find((function(e){return e.username===t.username}))?d(!0):d(!1)}),[t,a]);var j=t?l?Object(M.jsx)(C.a,{color:"teal",onClick:c,children:Object(M.jsx)(U.a,{name:"heart"})}):Object(M.jsx)(C.a,{color:"teal",basic:!0,onClick:c,children:Object(M.jsx)(U.a,{name:"heart"})}):Object(M.jsx)(C.a,{as:b.b,to:"/login",color:"teal",basic:!0,children:Object(M.jsx)(U.a,{name:"heart"})});return Object(M.jsxs)(C.a,{as:"div",labelPosition:"right",children:[j,Object(M.jsx)(Q.a,{basic:!0,color:"teal",pointing:"left",children:a.length})]})}var K,W,X=n(60),Y=n.n(X),Z=n(245);function _(e){var t=e.postId,n=e.callback,s=e.commentId,a=Object(u.useState)(!1),r=Object(y.a)(a,2),c=r[0],o=r[1],i=s?te:ne,l=Object(p.useMutation)(i,{variables:{postId:t,commentId:s},update:function(e,a){if(o(!1),!s){var r=e.readQuery({query:P}).getPosts.filter((function(e){return e.id!==t}));e.writeQuery({query:P,data:{getPosts:Object(v.a)(r)}}),n&&n()}}}),d=Object(y.a)(l,1)[0];return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(C.a,{as:"div",color:"red",floated:"right",onClick:function(){return o(!0)},children:Object(M.jsx)(U.a,{name:"trash",style:{margin:0}})}),Object(M.jsx)(Z.a,{open:c,onCancel:function(){return o(!1)},onConfirm:d})]})}var ee,te=Y()(K||(K=Object(f.a)(["\n     mutation deleteComment($postId: ID!, $commentId: ID!) {\n          deleteComment(postId: $postId, commentId: $commentId) {\n               id\n               comments {\n                    id\n                    username\n                    createdAt\n                    body\n               }\n          }\n     }\n"]))),ne=Y()(W||(W=Object(f.a)(["\n     mutation deletePost($postId: ID!) {\n          deletePost(postId: $postId)\n     }\n"])));function se(e){var t=e.post,n=t.body,s=t.createdAt,a=t.id,r=t.username,c=t.comments,o=(t.commentCount,t.likes),i=t.likeCount,l=Object(u.useContext)(z).user;return Object(M.jsxs)("div",{className:"post",children:[Object(M.jsx)("img",{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",alt:r}),Object(M.jsxs)("div",{className:"post-content",children:[Object(M.jsx)(b.b,{to:"/user/".concat(r),children:Object(M.jsx)("h3",{className:"username",children:r})}),Object(M.jsxs)(b.b,{to:"/posts/".concat(a),children:[Object(M.jsx)("p",{className:"created",children:q()(s).fromNow()}),Object(M.jsx)("p",{className:"post-body",children:n})]}),Object(M.jsx)(V,{user:l,post:{id:a,likes:o,likeCount:i}}),Object(M.jsxs)(C.a,{labelPosition:"right",onClick:function(){},as:b.b,to:"/posts/".concat(a),children:[Object(M.jsx)(C.a,{color:"blue",basic:!0,children:Object(M.jsx)(U.a,{name:"comments"})}),Object(M.jsx)(Q.a,{basic:!0,color:"blue",pointing:"left",children:c.length})]}),l&&l.username===r&&Object(M.jsx)(_,{postId:a})]})]})}function ae(){var e=Object(u.useContext)(z).user,t=Object(p.useQuery)(P),n=t.loading,s=t.data,a=(s=void 0===s?{}:s).getPosts;return Object(M.jsxs)("div",{className:"posts",children:[e&&Object(M.jsx)(D,{}),n?Object(M.jsx)(h.a,{inverted:!0,content:"Loading"}):Object(M.jsx)(x.a.Group,{children:a&&a.map((function(e){return Object(M.jsx)(g.a.Column,{children:Object(M.jsx)(se,{post:e})},e.id)}))})]})}var re,ce=Y()(ee||(ee=Object(f.a)(["\n     mutation login($username: String!, $password: String!) {\n          login(username: $username, password: $password) {\n               id\n               email\n               username\n               createdAt\n               token\n          }\n     }\n"]))),oe=function(e){var t=Object(u.useContext)(z),n=Object(u.useState)({}),s=Object(y.a)(n,2),a=s[0],r=s[1],c=S((function(){b()}),{username:"",password:""}),o=c.onChange,i=c.onSubmit,l=c.values,d=Object(p.useMutation)(ce,{update:function(n,s){var a=s.data.login;t.login(a),e.history.push("/")},onError:function(e){r(e.graphQLErrors[0].extensions.exception.errors)},variables:l}),j=Object(y.a)(d,2),b=j[0],m=j[1].loading;return Object(M.jsxs)("div",{className:"form-container",children:[Object(M.jsxs)(I.a,{onSubmit:i,noValidate:!0,className:m?"loading":"",children:[Object(M.jsx)("h1",{children:"Login"}),Object(M.jsx)(I.a.Input,{label:"Username",placeholder:"Username..",name:"username",type:"text",value:l.username,error:!!a.username,onChange:o}),Object(M.jsx)(I.a.Input,{label:"Password",placeholder:"Password..",name:"password",type:"password",value:l.password,error:!!a.password,onChange:o}),Object(M.jsx)(C.a,{type:"submit",primary:!0,children:"Login"})]}),Object.keys(a).length>0&&Object(M.jsx)("div",{className:"ui error message",children:Object(M.jsx)("ul",{className:"list",children:Object.values(a).map((function(e){return Object(M.jsx)("li",{children:e},e)}))})})]})};function ie(e){Object(u.useContext)(z).user&&(window.location.href="/");var t=Object(u.useContext)(z),n=Object(u.useState)({}),s=Object(y.a)(n,2),a=s[0],r=s[1],c=S((function(){b()}),{username:"",email:"",password:"",confirmPassword:""}),o=c.onChange,i=c.onSubmit,l=c.values,d=Object(p.useMutation)(le,{update:function(n,s){var a=s.data.register;t.login(a),e.history.push("/")},onError:function(e){console.log(e),r(e.graphQLErrors[0].extensions.exception.errors)},variables:l}),j=Object(y.a)(d,2),b=j[0],m=j[1].loading;return Object(M.jsxs)("div",{className:"form-container",children:[Object(M.jsxs)(I.a,{onSubmit:i,noValidate:!0,className:m?"loading":"",children:[Object(M.jsx)("h1",{children:"Register"}),Object(M.jsx)(I.a.Input,{label:"Username",placeholder:"Username..",name:"username",type:"text",value:l.username,errors:!!a.username,onChange:o}),Object(M.jsx)(I.a.Input,{label:"Email",placeholder:"Email..",name:"email",type:"email",value:l.email,errors:!!a.email,onChange:o}),Object(M.jsx)(I.a.Input,{label:"Password",placeholder:"Password..",name:"password",type:"password",value:l.password,errors:!!a.password,onChange:o}),Object(M.jsx)(I.a.Input,{label:"Confirm Password",placeholder:"Confirm Password..",name:"confirmPassword",type:"password",value:l.confirmPassword,errors:!!a.confirmPassword,onChange:o}),Object(M.jsx)(C.a,{type:"submit",primary:!0,children:"Register"})]}),Object.keys(a).length>0&&Object(M.jsx)("div",{className:"ui error message",children:Object(M.jsx)("div",{className:"list",children:Object.values(a).map((function(e){return Object(M.jsx)("li",{children:e},e)}))})})]})}var le=Y()(re||(re=Object(f.a)(["\n     mutation register(\n          $username: String!\n          $email: String!\n          $password: String!\n          $confirmPassword: String!\n     ) {\n          register(\n               registerInput: {\n                    username: $username\n                    email: $email\n                    password: $password\n                    confirmPassword: $confirmPassword\n               }\n          ) {\n               id\n               email\n               username\n               createdAt\n               token\n          }\n     }\n"]))),de=n(201),je=n(246);function ue(e){var t,n=e.match.params.postId,s=Object(u.useContext)(z).user,a=Object(u.useState)(""),r=Object(y.a)(a,2),c=r[0],o=r[1],i=Object(p.useQuery)(A,{variables:{postId:n}}).data,l=(i=void 0===i?{}:i).getPost,d=Object(u.useRef)(null),j=Object(p.useMutation)($,{update:function(){o(""),d.current.blur()},variables:{postId:n,body:c},errorPolicy:"all"}),b=Object(y.a)(j,1)[0];if(l){var m=l.id,O=l.body,h=l.createdAt,x=l.username,f=l.comments,v=l.likes;t=Object(M.jsx)(g.a,{style:{paddingTop:"60px",justifyContent:"center"},children:Object(M.jsxs)(g.a.Row,{children:[Object(M.jsx)(g.a.Column,{width:2,children:Object(M.jsx)(de.a,{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",size:"small",float:"right",style:{borderRadius:"50%"}})}),Object(M.jsxs)(g.a.Column,{width:10,children:[Object(M.jsxs)(je.a,{fluid:!0,children:[Object(M.jsxs)(je.a.Content,{children:[Object(M.jsx)(je.a.Header,{className:"username",children:x}),Object(M.jsx)(je.a.Meta,{className:"created",children:q()(h).fromNow(!0)}),Object(M.jsx)(je.a.Description,{className:"post-body",children:O})]}),Object(M.jsx)("hr",{}),Object(M.jsxs)(je.a.Content,{children:[Object(M.jsx)(V,{user:s,post:{id:m,likes:v}}),Object(M.jsxs)(C.a,{as:"div",labelPosition:"right",onClick:function(){return console.log("comment on post")},children:[Object(M.jsx)(C.a,{basic:!0,color:"blue",children:Object(M.jsx)(U.a,{name:"comments"})}),Object(M.jsx)(Q.a,{basic:!0,color:"blue",pointing:"left",children:f.length})]}),s&&s.username===x&&Object(M.jsx)(_,{postId:m,callback:function(){e.history.push("/")}})]})]}),v&&v.length>0&&Object(M.jsx)(je.a,{fluid:!0,children:Object(M.jsxs)(je.a.Content,{children:[Object(M.jsx)("p",{children:"Liked by"}),v.map((function(e){return Object(M.jsxs)(Q.a,{image:!0,children:[Object(M.jsx)("img",{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",alt:e.username}),e.username]},e.username)}))]})}),s&&Object(M.jsx)(je.a,{fluid:!0,children:Object(M.jsxs)(je.a.Content,{children:[Object(M.jsx)("p",{children:"Post a comment"}),Object(M.jsx)(I.a,{children:Object(M.jsxs)("div",{className:"ui action input fluid",children:[Object(M.jsx)("input",{type:"text",placeholder:"Comment..",name:"comment",value:c,onChange:function(e){return o(e.target.value)},ref:d}),Object(M.jsx)("button",{type:"submit",className:"ui button teal",disabled:""===c.trim(),onClick:b,children:"Submit"})]})})]})}),f.map((function(e){return Object(M.jsx)(je.a,{fluid:!0,children:Object(M.jsxs)(je.a.Content,{children:[s&&s.username===e.username&&Object(M.jsx)(_,{postId:m,commentId:e.id}),Object(M.jsx)(je.a.Header,{className:"username",children:e.username}),Object(M.jsx)(je.a.Meta,{className:"createdat",children:q()(e.createdAt).fromNow(!0)}),Object(M.jsx)(je.a.Description,{children:e.body})]})},e.id)}))]})]})})}else t=Object(M.jsx)("p",{children:"Loading post..."});return t}function be(e){var t=e.match.params.username,n=Object(u.useContext)(z).user,s=Object(p.useQuery)(T,{variables:{username:t}}).data,a=(s=void 0===s?{}:s).getUserInfo,r=S((function(){}),{description:""}),c=r.values,o=r.onChange,i=r.onSubmit;return Object(M.jsx)(M.Fragment,{children:a?Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("div",{style:{paddingTop:"1rem"}}),Object(M.jsx)(je.a,{fluid:!0,className:"user-profile",children:Object(M.jsxs)(je.a.Content,{style:{display:"flex"},children:[Object(M.jsx)(de.a,{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",size:"small",float:"left",style:{borderRadius:"50%"}}),Object(M.jsxs)("div",{className:"user-info-page",children:[Object(M.jsx)("h3",{className:"username",children:a.username}),Object(M.jsxs)("p",{className:"created",children:["User signed up"," ",q()(a.createdAt).fromNow()]}),Object(M.jsx)("p",{className:"description",children:a.description?"No description added":(null===n||void 0===n?void 0:n.username)===t?Object(M.jsxs)(I.a,{onSubmit:i,children:[Object(M.jsx)("h3",{children:"Add a description"}),Object(M.jsxs)(I.a.Field,{children:[Object(M.jsx)(I.a.Input,{placeholder:"Add a description",name:"body",onChange:o,value:c.body}),Object(M.jsx)(C.a,{type:"submit",color:"teal",children:"SUBMIT"})]})]}):Object(M.jsxs)("p",{children:[t," doesn't have a description."]})})]})]})})]}):Object(M.jsx)("div",{children:"Loading.."})})}function me(){var e=Object(u.useContext)(z),t=e.user,n=e.logout,s=window.location.pathname;"/"===s||s.substr(1);return t?Object(M.jsxs)("nav",{className:"navbar",children:[Object(M.jsx)(b.b,{to:"/",className:"logo",children:"POSTS"}),Object(M.jsx)("div",{className:"user-options",children:Object(M.jsx)("button",{position:"right",onClick:n,as:b.b,to:"/login",children:Object(M.jsx)("i",{className:"fas fa-sign-out-alt"})})})]}):Object(M.jsxs)("nav",{className:"navbar",children:[Object(M.jsx)(b.b,{to:"/",className:"logo",children:"SOCIAL MEDIA"}),Object(M.jsxs)("div",{className:"user-options",children:[Object(M.jsx)(b.b,{to:"/login",className:"option-item",children:"LOGIN"}),Object(M.jsx)(b.b,{to:"/register",className:"option-item",children:"REGISTER"})]})]})}var Oe=function(){return Object(M.jsx)(J,{children:Object(M.jsxs)(b.a,{children:[Object(M.jsx)(me,{}),Object(M.jsxs)(O.a,{children:[Object(M.jsx)(m.b,{exact:!0,path:"/",component:ae}),Object(M.jsx)(m.b,{exact:!0,path:"/login",component:oe}),Object(M.jsx)(m.b,{exact:!0,path:"/register",component:ie}),Object(M.jsx)(m.b,{exact:!0,path:"/posts/:postId",component:ue}),Object(M.jsx)(m.b,{exact:!0,path:"/user/:username",component:be})]})]})})},pe=n(202),he=Object(p.createHttpLink)({uri:"https://Social-Media-App.chase8.repl.co"}),xe=Object(pe.a)((function(){var e=localStorage.getItem("jwtToken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}})),ge=new p.ApolloClient({link:xe.concat(he),cache:new p.InMemoryCache}),fe=Object(M.jsx)(p.ApolloProvider,{client:ge,children:Object(M.jsx)(Oe,{})});j.a.render(fe,document.getElementById("root"))}},[[228,1,2]]]);
//# sourceMappingURL=main.72fc7c4f.chunk.js.map